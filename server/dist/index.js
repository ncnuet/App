(()=>{"use strict";var e={4742:(e,t)=>{function n(){return Object.assign({},t.cookieSecureOption)}Object.defineProperty(t,"__esModule",{value:!0}),t.withSession=t.withAge=t.cookieSecureOption=void 0,t.cookieSecureOption={httpOnly:!0,secure:!0},t.withAge=function(e){return void 0===e?n():Object.assign(Object.assign({},t.cookieSecureOption),{maxAge:e})},t.withSession=n},2009:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.connect=void 0;const o=i(n(1185)),a=i(n(5343)),{MG_HOST:s,MG_PORT:u,MG_NAME:c,MG_USERNAME:d,MG_PASSWORD:l,MONGODB_URI:f}=a.default;o.default.set("strictQuery",!0);const p=f||`mongodb+srv://${d}:${l}@${s}/${c}?retryWrites=true&w=majority`;console.log(p),t.connect=()=>r(void 0,void 0,void 0,(function*(){return o.default.connect(p,{})}))},5343:function(e,t,n){var r=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.env=void 0;const o=n(5142),a=i(n(1017)),s=process.env,{NODE_ENV:u}=s,c=r(s,["NODE_ENV"])||{},d=(0,o.config)("dev"===u?{path:a.default.resolve(process.cwd(),".env.dev")}:void 0).parsed;t.env="production",t.default=Object.assign(Object.assign(Object.assign({},d),{ENV:"production"}),c)},1633:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.JWTResetOpt=t.JWTRefreshOpt=t.JWTTokenOpt=void 0;const i=r(n(5343));t.JWTTokenOpt={expiresIn:"dev"===i.default.ENV?"10s":"3600s"},t.JWTRefreshOpt={expiresIn:"dev"===i.default.ENV?"60s":"86400s"},t.JWTResetOpt={expiresIn:"dev"===i.default.ENV?"180s":"300s"}},6168:function(e,t,n){var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=o(n(5184)),u=a(n(5343)),c=s.createTransport({pool:!0,service:u.default.MAIL_SERVICE,auth:{user:u.default.MAIL_USER,pass:u.default.MAIL_PASSWORD}});t.default=c},9818:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.startup=t.setupRedisIndex=t.redis=void 0;const o=n(7773),a=i(n(5343)),s=n(9372);function u(){return r(this,void 0,void 0,(function*(){yield(0,s.setTokenIndex)()}))}t.redis=(0,o.createClient)({password:a.default.RD_PASSWORD,username:a.default.RD_USERNAME,socket:{host:a.default.RD_HOST,port:Number(a.default.RD_PORT)}}),t.setupRedisIndex=u,t.startup=function(){return r(this,void 0,void 0,(function*(){yield t.redis.connect(),yield u()}))}},6464:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=n(4742),a=n(7797),s=i(n(8849)),u=i(n(4747)),c=i(n(5215)),d=i(n(4947)),l=n(3713),f=i(n(5343));t.default=class{static login(e,t){return r(this,void 0,void 0,(function*(){const n=e.body;console.log(n),yield(0,s.default)(t,(()=>r(this,void 0,void 0,(function*(){u.default.validateLoginPassword(n);const e=yield c.default.findUserByPassword(n.username,n.password);if(e){const r=(yield d.default.getVersion(e.uid))||"0",i=(0,a.generateToken)(Object.assign(Object.assign({},e),{version:r,remember:n.remember}),!0);yield d.default.insertRefreshToken(i.refreshToken,e.uid,e.role),function(e,t,n,r){r&&e.cookie("refresh_token",r,(0,o.withAge)(864e5)),e.status(200).cookie("token",n,(0,o.withAge)(t?36e5:void 0)).json({message:"success",data:{accessToken:n,refreshToken:r}}).send()}(t,n.remember,i.accessToken,i.refreshToken)}else t.status(401).json({message:"TÃ i khoáº£n hoáº·c máº­t kháº©u khÃ´ng chÃ­nh xÃ¡c",name:"password"})}))))}))}static logout(e,t){return r(this,void 0,void 0,(function*(){const e=t.locals.user;yield(0,s.default)(t,(()=>r(this,void 0,void 0,(function*(){d.default.deleteRefreshToken(e.uid),d.default.updateVersion(e.uid),t.cookie("token",null,(0,o.withAge)(0)),t.cookie("refresh_token",null,(0,o.withAge)(0)),t.sendStatus(200)}))))}))}static requestReset(e,t){return r(this,void 0,void 0,(function*(){const n=e.body;console.log(n),yield(0,s.default)(t,(()=>r(this,void 0,void 0,(function*(){u.default.validateRequestReset(n);const e=yield c.default.findUserByInfo(n);if(e){const{username:n,uid:r}=e,i=(0,a.generateResetToken)({username:n,uid:r,role:"admin",version:"0",remember:!1});yield(0,l.sendForgetPasswordMail)(e,i),t.status(200).json({message:"Email Ä‘Ã£ Ä‘Æ°á»£c gá»­i thÃ nh cÃ´ng tá»›i "+e.email})}else t.status(400).json({message:"KhÃ´ng tá»“n táº¡i email",name:"email"})}))))}))}static verifyReset(e,t){return r(this,void 0,void 0,(function*(){const n=t.locals.user.username,r=1e3*t.locals.user.exp,i=Math.floor((r-(new Date).getTime())/1e3);t.cookie("token",e.query.token,(0,o.withAge)(18e4)).redirect(f.default.FRONTEND+"/resetpassword?ttl="+i+"&user="+n)}))}static resetPassword(e,t){return r(this,void 0,void 0,(function*(){const n=e.body;yield(0,s.default)(t,(()=>r(this,void 0,void 0,(function*(){u.default.validateReset(n);const e=t.locals.user;yield c.default.updatePassword(e.uid,n.password),t.json({message:"Password changed successfully"})}))))}))}}},6305:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=i(n(5215)),a=i(n(4947));t.default=new class{getStatus(e,t){t.json({message:"OK"})}getUser(e,t){return r(this,void 0,void 0,(function*(){const n=e.body;console.log(n);const r=yield o.default.findUserByPassword(n.username,n.password);console.log(r),r?t.json({message:"hello",data:r}):t.json({message:"error",data:{}})}))}addToken(e,t){return r(this,void 0,void 0,(function*(){yield a.default.insertRefreshToken("sdcasdcasdcasdc","21020365","admin"),t.json({message:"OK"})}))}}},3607:function(e,t,n){e=n.nmd(e);var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t},a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const u=s(n(6860)),c=o(n(3582)),d=s(n(9470)),l=s(n(9710)),f=s(n(8479)),p=o(n(5343)),h=o(n(2009)),v=o(n(9818)),y=s(n(6950)),_=n(7520),m=(0,u.default)(),g=p.default.PORT;m.use((0,d.default)("dev"===p.env?"dev":"tiny")),m.use(u.default.json()),m.use(u.default.urlencoded({extended:!0})),m.use((0,l.default)()),m.use(c.default({origin:p.default.FRONTEND,credentials:!0,methods:["GET","PUT","POST","DELETE"],optionsSuccessStatus:200,allowedHeaders:["Content-Type, Authorization"]})),(0,f.default)(m),m.use("/v1/graphql/",(0,_.graphqlHTTP)({schema:y.default,graphiql:!0})),n.c[n.s]===e&&m.listen(g,(()=>a(void 0,void 0,void 0,(function*(){yield v.startup(),console.log("ðŸ“• [database]: Connected to redis"),yield h.connect(),console.log("ðŸ“’ [database]: Connected to mongo"),console.log(`âœ… [server]: Server is running at http://localhost:${g}`)})))),t.default=m},322:function(e,t,n){var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t},a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.checkJWT=void 0;const u=o(n(9344)),c=s(n(5343)),d=n(5326),l=s(n(4947));t.checkJWT=function(e,t,n){return a(this,void 0,void 0,(function*(){const r=this&&"query"===this.tokenOn?e.query.token:e.cookies.token;if(!r)return t.sendStatus(401);try{const e=u.verify(r,c.default.JWT_KEY),i=yield l.default.getVersion(e.uid);if(i&&i!==e.version)return t.sendStatus(401);t.locals.user=e,n()}catch(r){if(!(r instanceof u.TokenExpiredError))return console.log(r),t.sendStatus(401);(0,d.checkRWT)(e,t,n)}}))}},5326:function(e,t,n){var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t},a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.checkRWT=void 0;const u=o(n(9344)),c=s(n(5343)),d=n(7797),l=s(n(4947)),f=n(4742),p=s(n(8849));t.checkRWT=function(e,t,n){return a(this,void 0,void 0,(function*(){const r=e.cookies.refresh_token;(0,p.default)(t,(()=>a(this,void 0,void 0,(function*(){if(!r||!(yield l.default.getRefreshToken(r)))return t.sendStatus(401);try{const e=u.verify(r,c.default.JWT_REFRESH_KEY);e.role=yield l.default.getRole(e.uid),e.version=yield l.default.getVersion(e.uid);const i=(0,d.generateToken)(e,!0);yield l.default.insertRefreshToken(i.refreshToken,e.uid,e.role),t.cookie("refresh_token",i.refreshToken,(0,f.withAge)(864e5)).cookie("token",i.accessToken,(0,f.withAge)(e.remember?36e5:void 0)).locals.user=e,n()}catch(e){console.log(e),t.sendStatus(401)}}))))}))}},6990:function(e,t,n){var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.checkReset=void 0;const s=o(n(9344)),u=a(n(5343));t.checkReset=function(e,t,n){const r=e.query.token||e.cookies.token;if(!r)return t.sendStatus(401);try{const e=s.verify(r,u.default.JWT_RESET_KEY);t.locals.user=e,n()}catch(e){return console.log(e),t.sendStatus(401)}}},5215:function(e,t,n){var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t},a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const s=o(n(8432)),u=n(6820);t.default=new class{findUserByPassword(e,t){return a(this,void 0,void 0,(function*(){const n=yield u.UserBaseModel.findOne({username:e},{_id:1,role:1,username:1,password:1}).exec();if(!n)return;const{_id:r,username:i,password:o,role:a}=n;return t?(yield s.compare(t,o))&&{uid:r,username:i,role:a}:void 0}))}findUserByInfo(e){return a(this,void 0,void 0,(function*(){const t=yield u.UserBaseModel.findOne({$or:[{username:e.username},{email:e.email},{phone:e.phone},{uid:e.uid}]},{email:!0,username:!0,phone:!0,_id:!0}).exec();if(!t)return;const{username:n,phone:r,_id:i,email:o}=t;return{username:n,phone:r,uid:i,email:o}}))}updatePassword(e,t){return a(this,void 0,void 0,(function*(){u.UserBaseModel.updateOne({_id:e},{password:yield s.hash(t,10)}).exec()}))}}},9656:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ParcelBaseModel=void 0;const r=n(1185),i=n(7181);t.ParcelBaseModel=(0,r.model)("Parcel",i.parcelSchema)},2002:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PostOfficeBaseModel=void 0;const r=n(1185),i=n(2509);t.PostOfficeBaseModel=(0,r.model)("PostOffice",i.postOfficeSchema)},6899:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TrackingBaseModel=void 0;const r=n(1185),i=n(9716);t.TrackingBaseModel=(0,r.model)("Tracking",i.trackingSchema)},6820:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UserBaseModel=void 0;const r=n(1185),i=n(5102);t.UserBaseModel=(0,r.model)("User",i.userSchema)},2523:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const i=n(9656);t.default=new class{getParcel(e){return r(this,void 0,void 0,(function*(){return(yield i.ParcelBaseModel.find({_id:{$in:e}}).exec()).map((e=>{const{_id:t,sender:n,sending_add:r,receiver:i,receiving_add:o,status:a,goods:s,notes:u,sending_office:c,receiving_office:d}=e;return{pid:t.toString(),sender:n,sending_add:r,receiver:i,receiving_add:o,status:a,goods:s,notes:u,sending_office:c.toString(),receiving_office:d.toString()}}))}))}}},4681:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const i=n(2002);t.default=new class{createPostOffice(e){return r(this,void 0,void 0,(function*(){const t=new i.PostOfficeBaseModel(e);yield t.save()}))}getPostOffices(e){return r(this,void 0,void 0,(function*(){return(yield i.PostOfficeBaseModel.find({_id:{$in:e}}).exec()).map((e=>{const{_id:t,name:n,address:r,contact:i,post_office_type:o,manager:a,gather_office:s}=e;return{poid:t.toString(),name:n,address:r,contact:i,post_office_type:o,manager:a.toString(),gather_office:s.toString()}}))}))}}},4841:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.addressSchema=t.addressLevelSchema=void 0;const r=n(1185);t.addressLevelSchema=new r.Schema({id:{type:String,required:!0},name:{type:String,required:!0}}),t.addressSchema=new r.Schema({country:{type:t.addressLevelSchema,required:!0},province:{type:t.addressLevelSchema,required:!0},district:{type:t.addressLevelSchema,required:!0},commune:{type:t.addressLevelSchema,required:!0},detail:{type:String},lat:{type:Number},long:{type:Number}})},6304:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.contactSchema=void 0;const r=n(1185);t.contactSchema=new r.Schema({hotline:{type:String},fax:{type:String},email:{type:String}})},6248:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.customerSchema=void 0;const r=n(1185);t.customerSchema=new r.Schema({name:{type:String,required:!0},phone:{type:String,required:!0}})},5106:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.trackingEventSchema=void 0;const r=n(1185),i=n(6820);t.trackingEventSchema=new r.Schema({name:{type:String,required:!0},responsor:{type:r.Schema.Types.ObjectId,required:!0,ref:i.UserBaseModel}})},4657:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.goodsSchema=t.EGoodsCategory=void 0;const r=n(1185);var i;!function(e){e.ELECTRONICE_DEVICE="Electronic Devices"}(i||(t.EGoodsCategory=i={})),t.goodsSchema=new r.Schema({name:{type:String},category:{type:String},quantity:{type:Number},value:{type:Number},weight:{type:Number},attached:{type:String}})},7181:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.parcelSchema=t.EParcelStatus=void 0;const r=n(1185),i=n(4841),o=n(6248),a=n(4657),s=n(2002);var u;!function(e){e.DELIVERING="delivering",e.DELIVERED="delivered",e.FAILED="failed"}(u||(t.EParcelStatus=u={})),t.parcelSchema=new r.Schema({pid:{type:String,required:!0,unique:!0,index:!0},sender:{type:o.customerSchema,required:!0},sending_add:{type:i.addressSchema,required:!0},sending_office:{type:r.Schema.Types.ObjectId,require:!0,ref:s.PostOfficeBaseModel},receiver:{type:o.customerSchema,required:!0},receiving_add:{type:i.addressSchema,required:!0},receiving_office:{type:r.Schema.Types.ObjectId,require:!0,ref:s.PostOfficeBaseModel},status:{type:String,required:!0},goods:{type:[a.goodsSchema],required:!0},notes:{type:String}})},2509:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.postOfficeSchema=void 0;const r=n(1185),i=n(6820),o=n(6304);t.postOfficeSchema=new r.Schema({name:{type:String,required:!0},address:{type:Object,required:!0},manager:{type:r.Schema.Types.ObjectId,required:!0,ref:i.UserBaseModel},contact:{type:o.contactSchema,required:!0},post_office_type:{type:String,required:!0},gather_office:{type:r.Schema.Types.ObjectId}})},9372:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.setTokenIndex=t.schema=void 0;const i=n(9818),o=n(7773);t.schema={"$.token":{type:o.SchemaFieldTypes.TEXT,AS:"token"},"$.uid":{type:o.SchemaFieldTypes.TEXT,AS:"uid"}},t.setTokenIndex=function(){return r(this,void 0,void 0,(function*(){try{yield i.redis.ft.create("idx:token",t.schema,{ON:"JSON",PREFIX:"token_"})}catch(e){"Index already exists"===e.message?console.log("Index idx:token exists already, skipped creation."):console.error(e)}}))}},9716:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.trackingSchema=void 0;const r=n(1185),i=n(9656),o=n(2002),a=n(5106);t.trackingSchema=new r.Schema({post_office:{type:r.Schema.Types.ObjectId,required:!0,ref:o.PostOfficeBaseModel},parcel:{type:r.Schema.Types.ObjectId,required:!0,ref:i.ParcelBaseModel},events:{type:[a.trackingEventSchema]}},{timestamps:!0})},5102:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.userSchema=void 0;const r=n(1185);t.userSchema=new r.Schema({username:{type:String,required:!0,unique:!0,index:!0},password:{type:String,required:!0},role:{type:String,required:!0},version:{type:Number,required:!0},email:{type:String,unique:!0,index:!0},phone:{type:String,unique:!0,index:!0},name:{type:String}},{timestamps:!0})},4947:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const i=n(9818),o=n(4816);t.default=new class{insertRefreshToken(e,t,n){return r(this,void 0,void 0,(function*(){if(yield i.redis.set((0,o.getKey)(t,o.NameType.USER_VERSION),0,{NX:!0}),"OK"!==(yield i.redis.json.set((0,o.getKey)(e,o.NameType.TOKEN),"$",{uid:t,token:e}))||"OK"!==(yield i.redis.set((0,o.getKey)(t,o.NameType.USER_ROLE),n)))throw new Error("Unable to add refresh token")}))}getRefreshToken(e){return r(this,void 0,void 0,(function*(){return yield i.redis.json.get((0,o.getKey)(e,o.NameType.TOKEN))}))}deleteRefreshToken(e){return r(this,void 0,void 0,(function*(){const t=yield i.redis.ft.search("idx:token",`@uid:"${e}"`);t&&(yield Promise.all(t.documents.map((e=>i.redis.json.del(e.id)))))}))}updateVersion(e){return r(this,void 0,void 0,(function*(){if(!i.redis.incr((0,o.getKey)(e,o.NameType.USER_VERSION)))throw new Error("Unable to update version")}))}getVersion(e){return r(this,void 0,void 0,(function*(){return yield i.redis.get((0,o.getKey)(e,o.NameType.USER_VERSION))}))}getRole(e){return r(this,void 0,void 0,(function*(){return yield i.redis.get((0,o.getKey)(e,o.NameType.USER_ROLE))}))}}},1066:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=i(n(1185)),a=n(6899);t.default=new class{getTrackingByParcelID(e){return r(this,void 0,void 0,(function*(){return(yield a.TrackingBaseModel.find({parcel:new o.default.Types.ObjectId(e)},{post_office:1,parcel:1,events:1,_id:1}).exec()).map((e=>{const{_id:t,parcel:n,post_office:r,events:i}=e;return{tid:t.toString(),parcel:n.toString(),post_office:r.toString(),events:i}}))}))}}},5805:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const i=n(6820);t.default=new class{getUsers(e){return r(this,void 0,void 0,(function*(){return(yield i.UserBaseModel.find({_id:{$in:e}},{email:1,username:1,phone:1,_id:1,name:1}).exec()).map((e=>{const{_id:t,email:n,username:r,phone:i,name:o}=e;return{uid:t.toString(),email:n,username:r,phone:i,name:o}}))}))}}},8479:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=r(n(8961));t.default=function(e){e.use("/v1",i.default)}},9413:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=r(n(6860)),o=r(n(6464)),a=n(322),s=n(6990),u=i.default.Router();u.post("/login",o.default.login),u.post("/logout",[a.checkJWT],o.default.logout),u.post("/reset",o.default.requestReset),u.get("/reset",[s.checkReset],o.default.verifyReset),u.put("/reset",[s.checkReset],o.default.resetPassword),t.default=u},8961:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(6860),o=r(n(9690)),a=r(n(9413)),s=(0,i.Router)();s.use("/",o.default),s.use("/auth",a.default),t.default=s},9690:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=r(n(6860)),o=r(n(6305)),a=i.default.Router();a.get("/",o.default.getStatus),a.post("/user",o.default.getUser),a.post("/token",o.default.addToken),t.default=a},6950:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});const r=n(7343),i=n(7244),o=n(1504),a=n(8819),s=n(9038),u=new r.GraphQLObjectType({name:"Query",description:"Root Query",fields:()=>({parcels:o.parcelsQuery,users:a.userQuery,post_offices:i.postOfficeQuery,tracking:s.trackingQuery})}),c=new r.GraphQLSchema({query:u});t.default=c},1504:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.parcelsQuery=void 0;const o=i(n(2523)),a=n(7343),s=n(6329);t.parcelsQuery={type:(0,a.GraphQLList)(s.ParcelGraph),description:"Parcel Query",args:{pid:{type:a.GraphQLString},pids:{type:(0,a.GraphQLList)(a.GraphQLString)}},resolve:(e,t)=>r(void 0,void 0,void 0,(function*(){return t.pid?yield o.default.getParcel([t.pid]):t.pids&&Array.isArray(t.pids)?yield o.default.getParcel(t.pids):[]}))}},7244:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.postOfficeQuery=void 0;const o=n(7343),a=n(7590),s=i(n(4681));t.postOfficeQuery={type:(0,o.GraphQLList)(a.PostOfficeGraph),description:"PostOfficeQuery",args:{poid:{type:o.GraphQLString},poids:{type:(0,o.GraphQLList)(o.GraphQLString)}},resolve:(e,t)=>r(void 0,void 0,void 0,(function*(){return t.poid?yield s.default.getPostOffices([t.poid]):t.poid&&Array.isArray(t.poid)?yield s.default.getPostOffices(t.poids):[]}))}},9038:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.trackingQuery=void 0;const o=n(7343),a=n(236),s=i(n(1066));t.trackingQuery={type:(0,o.GraphQLList)(a.TrackingGraph),args:{pid:{type:o.GraphQLString}},resolve:(e,t)=>r(void 0,void 0,void 0,(function*(){return t.pid?yield s.default.getTrackingByParcelID(t.pid):null}))}},8819:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.userQuery=void 0;const o=n(7343),a=n(6797),s=i(n(5805));t.userQuery={type:(0,o.GraphQLList)(a.UserGraph),args:{uid:{type:o.GraphQLString},uids:{type:(0,o.GraphQLList)(o.GraphQLString)}},resolve:(e,t)=>r(void 0,void 0,void 0,(function*(){return t.uid?yield s.default.getUsers([t.uid]):t.uids&&Array.isArray(t.uids)?yield s.default.getUsers(t.uids):[]}))}},6536:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AddressGraph=t.AddressLevelGraph=void 0;const r=n(7343);t.AddressLevelGraph=new r.GraphQLObjectType({name:"AddressLevelGraph",description:"Address Level Graph",fields:{id:{type:r.GraphQLString},name:{type:r.GraphQLString}}}),t.AddressGraph=new r.GraphQLObjectType({name:"AddressGraph",description:"Address Graph",fields:{country:{type:t.AddressLevelGraph},province:{type:t.AddressLevelGraph},district:{type:t.AddressLevelGraph},commune:{type:t.AddressLevelGraph},detail:{type:r.GraphQLString},lat:{type:r.GraphQLFloat},long:{type:r.GraphQLFloat}}})},152:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ContactGraph=void 0;const r=n(7343);t.ContactGraph=new r.GraphQLObjectType({name:"ContactGraph",description:"Contact Graph",fields:{hotline:{type:r.GraphQLString},fax:{type:r.GraphQLString},email:{type:r.GraphQLString}}})},7669:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CustomerGraph=void 0;const r=n(7343);t.CustomerGraph=new r.GraphQLObjectType({name:"CustomerGraph",description:"Customer Graph",fields:{name:{type:r.GraphQLString},phone:{type:r.GraphQLString}}})},4824:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.TrackingEventGraph=void 0;const o=n(7343),a=n(6797),s=i(n(5805));t.TrackingEventGraph=new o.GraphQLObjectType({name:"TrackingEventGraph",description:"Tracking Event Graph",fields:{name:{type:o.GraphQLString},responsor:{type:(0,o.GraphQLList)(a.UserGraph),resolve:e=>r(void 0,void 0,void 0,(function*(){return yield s.default.getUsers([e.responsor.toString()])}))}}})},1697:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GoodsGraph=void 0;const r=n(4657),i=n(7343),o=new i.GraphQLEnumType({name:"GoodsCategoryEnum",description:"Goods Category Enum",values:{ELECTRONICE_DEVICE:{value:r.EGoodsCategory.ELECTRONICE_DEVICE}}});t.GoodsGraph=new i.GraphQLObjectType({name:"GoodsGraph",description:"Goods Graph",fields:{name:{type:i.GraphQLString},category:{type:o},quantity:{type:i.GraphQLInt},value:{type:i.GraphQLInt},weight:{type:i.GraphQLInt},attached:{type:i.GraphQLString}}})},6329:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ParcelGraph=void 0;const o=n(7343),a=n(6536),s=n(7669),u=n(1697),c=n(7181),d=n(7590),l=i(n(4681)),f=new o.GraphQLEnumType({name:"ParcelStatusEnum",description:"Parcel Status Enum",values:{DELIVERING:{value:c.EParcelStatus.DELIVERING},DELIVERED:{value:c.EParcelStatus.DELIVERED},FAILED:{value:c.EParcelStatus.FAILED}}});new o.GraphQLObjectType({name:"StatusGraph",description:"Status Graph",fields:{name:{type:o.GraphQLString},createdAt:{type:o.GraphQLInt}}}),t.ParcelGraph=new o.GraphQLObjectType({name:"ParcelGraph",description:"Parcel Graph",fields:{pid:{type:o.GraphQLString},sender:{type:s.CustomerGraph},sending_add:{type:a.AddressGraph},receiver:{type:s.CustomerGraph},receiving_add:{type:a.AddressGraph},status:{type:f},goods:{type:(0,o.GraphQLList)(u.GoodsGraph)},notes:{type:o.GraphQLString},sending_office:{type:(0,o.GraphQLList)(d.PostOfficeGraph),resolve:e=>r(void 0,void 0,void 0,(function*(){return yield l.default.getPostOffices([e.sending_office])}))},receiving_office:{type:(0,o.GraphQLList)(d.PostOfficeGraph),resolve:e=>r(void 0,void 0,void 0,(function*(){return yield l.default.getPostOffices([e.receiving_office])}))}}})},7590:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.PostOfficeTypeEnum=t.PostOfficeGraph=void 0;const o=n(7343),a=n(5967),s=n(6536),u=i(n(4681)),c=n(152),d=n(6797),l=i(n(5805)),f=new o.GraphQLEnumType({name:"PostOfficeTypeEnum",description:"Post Office Type Enum",values:{TRANSACTION:{value:a.EPostOfficeType.Transaction},GATHERING:{value:a.EPostOfficeType.Gather}}});t.PostOfficeTypeEnum=f;const p=new o.GraphQLObjectType({name:"PostOfficeGraph",description:"Post Office Graph",fields:()=>({poid:{type:o.GraphQLString},name:{type:o.GraphQLString},address:{type:s.AddressGraph},manager:{type:(0,o.GraphQLList)(d.UserGraph),resolve:e=>r(void 0,void 0,void 0,(function*(){return yield l.default.getUsers([e.manager])}))},contact:{type:c.ContactGraph},post_office_type:{type:f},gather_office:{type:(0,o.GraphQLList)(p),resolve:e=>r(void 0,void 0,void 0,(function*(){return yield u.default.getPostOffices([e.gather_office])}))}})});t.PostOfficeGraph=p},236:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.TrackingGraph=void 0;const o=n(7343),a=n(7590),s=n(6329),u=n(4824),c=i(n(4681)),d=i(n(2523));t.TrackingGraph=new o.GraphQLObjectType({name:"TrackingGraph",description:"Tracking Graph",fields:{tid:{type:o.GraphQLString},post_office:{type:(0,o.GraphQLList)(a.PostOfficeGraph),resolve:e=>r(void 0,void 0,void 0,(function*(){return yield c.default.getPostOffices([e.post_office])}))},parcel:{type:(0,o.GraphQLList)(s.ParcelGraph),resolve:e=>r(void 0,void 0,void 0,(function*(){return yield d.default.getParcel([e.parcel])}))},events:{type:(0,o.GraphQLList)(u.TrackingEventGraph)}}})},6797:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UserGraph=void 0;const r=n(7343);t.UserGraph=new r.GraphQLObjectType({name:"UserGraph",description:"User Graph",fields:{uid:{type:r.GraphQLString},name:{type:r.GraphQLString}}})},5417:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.InputError=void 0;class n extends Error{constructor(e,t){super(e),Object.setPrototypeOf(this,n.prototype),this.field=t}}t.InputError=n},5967:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.EPostOfficeType=void 0,function(e){e.Gather="gathering",e.Transaction="transaction"}(n||(t.EPostOfficeType=n={}))},7797:function(e,t,n){var r=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.generate_password=t.generateResetToken=t.generateToken=t.generate_uid=void 0;const o=n(9344),a=i(n(5343)),s=n(1633);function u(e,t){return Math.floor(Math.random()*(t-e))+e}t.generate_uid=function(e=8){return e=e>0?e:8,[...new Array(e)].map((()=>u(0,9).toString())).join("")},t.generateToken=function(e,t){const n=e,{iat:i,exp:u}=n,c=r(n,["iat","exp"]);return{accessToken:(0,o.sign)(c,a.default.JWT_KEY,s.JWTTokenOpt),refreshToken:t&&(0,o.sign)(c,a.default.JWT_REFRESH_KEY,s.JWTRefreshOpt)}},t.generateResetToken=function(e){const t=e,{iat:n,exp:i}=t,u=r(t,["iat","exp"]);return(0,o.sign)(u,a.default.JWT_RESET_KEY,s.JWTResetOpt)},t.generate_password=function(e=8){e=e>0?e:8;return[...new Array(e)].map((()=>"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890"[u(0,61)])).join("")}},8849:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const i=n(5417);t.default=function(e,t){return r(this,void 0,void 0,(function*(){try{yield t()}catch(t){console.log(t),t instanceof i.InputError?e.status(400).json({message:t.message,name:t.field}):e.sendStatus(500)}}))}},4816:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.getKey=t.NameType=void 0,function(e){e[e.USER_VERSION=0]="USER_VERSION",e[e.USER_ROLE=1]="USER_ROLE",e[e.TOKEN=2]="TOKEN"}(n||(t.NameType=n={})),t.getKey=function(e,t){return t===n.USER_VERSION&&e+"_v"||t===n.USER_ROLE&&e+"_r"||t===n.TOKEN&&"token_"+e||e}},3713:function(e,t,n){var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t},a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.startup=t.sendForgetPasswordMail=t.sendMail=t.renderTemplate=void 0;const u=s(n(6168)),c=s(n(5343)),d=o(n(2097)),l=o(n(7147)),f=o(n(1017));function p(e,t,n){return a(this,void 0,void 0,(function*(){yield u.default.sendMail({from:`"${c.default.APP_NAME}" <${c.default.MAIL_USER}>`,to:e,subject:t,html:n})}))}t.renderTemplate=(e,t)=>{const n=f.join(f.resolve(),e),r=l.readFileSync(n,"utf-8").toString();return d.compile(r)(t)},t.sendMail=p,t.sendForgetPasswordMail=function(e,n){return a(this,void 0,void 0,(function*(){const r="dev"===c.default.ENV?"/src/templates/forgot-password-email.html":"/templates/forgot-password-email",i=(0,t.renderTemplate)(r,{url:`${c.default.BACKEND}/auth/reset?token=${n}`,name:e.username});return yield p(e.email,"KhÃ´i phá»¥c máº­t kháº©u trÃªn "+c.default.APP_NAME,i)}))},t.startup=function(){return a(this,void 0,void 0,(function*(){return yield p("fakenoname02@gmail.com","Server started","Server started now")}))}},4747:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});const r=n(5417);class i{static validateUsername(e){if(!e||e.length<3||e.length>50)throw new r.InputError("Username cÃ³ Ä‘á»™ dÃ i tá»« 3 Ä‘áº¿n 50 kÃ½ tá»±","username");return!0}static validatePassword(e){if(!e||e.length<8||e.length>50)throw new r.InputError("Máº­t kháº©u cÃ³ Ä‘á»™ dÃ i tá»« 8 Ä‘áº¿n 50 kÃ½ tá»±","password");return!0}static validateEmail(e){if(!e||!/^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$/.test(e))throw new r.InputError("Email khÃ´ng há»£p lá»‡","email");return!0}static validateRePassword(e,t){if(t!=e)throw new r.InputError("Máº­t kháº©u nháº­p láº¡i cáº§n giá»‘ng máº­t kháº©u","re_password")}static validateLoginPassword(e){i.validateUsername(e.username),i.validatePassword(e.password)}static validateRequestReset(e){e.username&&i.validateUsername(e.username)||i.validateEmail(e.email)}static validateReset(e){i.validatePassword(e.password),i.validateRePassword(e.password,e.re_password)}}t.default=i},8432:e=>{e.exports=require("bcryptjs")},9710:e=>{e.exports=require("cookie-parser")},3582:e=>{e.exports=require("cors")},5142:e=>{e.exports=require("dotenv")},6860:e=>{e.exports=require("express")},7520:e=>{e.exports=require("express-graphql")},7343:e=>{e.exports=require("graphql")},2097:e=>{e.exports=require("handlebars")},9344:e=>{e.exports=require("jsonwebtoken")},1185:e=>{e.exports=require("mongoose")},9470:e=>{e.exports=require("morgan")},5184:e=>{e.exports=require("nodemailer")},7773:e=>{e.exports=require("redis")},7147:e=>{e.exports=require("fs")},1017:e=>{e.exports=require("path")}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var o=t[r]={id:r,loaded:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.loaded=!0,o.exports}n.c=t,n.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),n(n.s=3607)})();